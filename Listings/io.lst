C51 COMPILER V9.54   IO                                                                    04/22/2020 19:59:26 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE IO
OBJECT MODULE PLACED IN .\Objects\io.obj
COMPILER INVOKED BY: D:\keil5 mdk\C51\BIN\C51.EXE user\src\io.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\lib;.\user\inc) DEBUG 
                    -OBJECTEXTEND PRINT(.\Listings\io.lst) TABS(2) OBJECT(.\Objects\io.obj)

line level    source

   1          #include "Config.h"
   2          
   3          // ¿ªÂ©Êä³ö£º PXM1 H   PXM0 H   // ÄÚ²¿ÉÏÀ­¶Ï¿ª £­£­Ê¡µç
   4          // ¸ß×èÊäÈë£º PXM1 H   PXM0 L   // µçÁ÷¼È²»Á÷Èë£¬Ò²²»Á÷³ö£¡£­£­Ê¡µç
   5          // ÉÏÀ­Ë«Ïò£º PXM1 L   PXM0 L   // ÈõÉÏÀ­£¬¹àµçÁ÷¿É´ï20mA£¬À­µçÁ÷270uA 
   6          // ÍÆÍìÊä³ö£º PXM1 L   PXM0 H   // ¿É´ï20mA£¬Ðè¼ÓÏÞÁ÷µç×è£»£¨Ð¾Æ¬ÕûÌåÁ÷Èë/Á÷³öµçÁ÷²»³¬¹ý90mA£©
   7          
   8          
   9          // µçÔ´
  10          //u8 xdata g_bPower;
  11          //u8 xdata iPWR_In;
  12          // LED
  13          u8 xdata g_bLedRun, g_bLedSOS, g_bLedLamp, g_bLedCd;
  14          //u8 xdata g_bLedRunBak, g_bLedQjBak, g_bLedLampBak;
  15          bit g_isLedBak;
  16          bit isFlash, isFlashFast;
  17          
  18          
  19          
  20          /* ¸ù¾Ý±äÁ¿Êµ¼ÊÖ´ÐÐIO¿ÚµÄµÆ */
  21          void pLedRun()    
  22          {
  23   1      
  24   1        //ÔËÐÐµÆ
  25   1        switch (g_bLedRun)
  26   1        {
  27   2        case LED_OFF:
  28   2          IO_LED_RUN = OFF_LED;
  29   2          break;
  30   2        case LED_ON:
  31   2          IO_LED_RUN = ON_LED;
  32   2          break;
  33   2        case LED_FLASH_FAST:
  34   2          IO_LED_RUN = isFlashFast;
  35   2          break;
  36   2        case LED_FLASH:
  37   2          IO_LED_RUN = isFlash;
  38   2          break;
  39   2        default:
  40   2          break;
  41   2        }
  42   1      
  43   1        //Çó¾È
  44   1        switch (g_bLedSOS)
  45   1        {
  46   2        case LED_OFF:
  47   2          IO_LED_SOS = OFF_LED;
  48   2          break;
  49   2        case LED_ON:
  50   2          IO_LED_SOS = ON_LED;
  51   2          break;
  52   2        case LED_FLASH_FAST:
  53   2          IO_LED_SOS = isFlashFast;
  54   2          break;
C51 COMPILER V9.54   IO                                                                    04/22/2020 19:59:26 PAGE 2   

  55   2        case LED_FLASH:
  56   2          IO_LED_SOS = isFlash;
  57   2          break;
  58   2        default:
  59   2          break;
  60   2        }
  61   1      #if 0
                //³äµçµÆ
                switch (iPWR_In)
                {
                case 0:
                  g_bLedCd = LED_OFF;
                  break;
                case 1:
                  g_bLedCd = LED_FLASH;
                  break;
                case 2:
                  g_bLedCd = LED_ON;
                  break;
                }
              
                //ÕÕÃ÷µÆ
                switch (g_bLedLamp)
                {
                case LED_OFF:
                  IO_LED_LAMP1 = OFF_LED;
                  IO_LED_LAMP2 = OFF_LED;
                  break;
                case LED_ON:
                  IO_LED_LAMP1 = ON_LED;
                  IO_LED_LAMP2 = ON_LED;
                  break;
                case LED_FLASH_FAST:
                  IO_LED_LAMP1 = isFlashFast;
                  IO_LED_LAMP2 = isFlashFast;
                  break;
                case LED_FLASH:
                  IO_LED_LAMP1 = isFlash;
                  IO_LED_LAMP2 = isFlash;
                  break;
                default:
                  break;
                }
              
                //³äµçÖ¸Ê¾µÆ
                switch (g_bLedCd)
                {
                case LED_OFF:
                  IO_LED_PWRIN = OFF_LED;
                  break;
                case LED_ON:
                  IO_LED_PWRIN = ON_LED;
                  break;
                case LED_FLASH_FAST:
                  IO_LED_PWRIN = isFlashFast;
                  break;
                case LED_FLASH:
                  IO_LED_PWRIN = isFlash;
                  break;
                default:
                  break;
                }
C51 COMPILER V9.54   IO                                                                    04/22/2020 19:59:26 PAGE 3   

              #endif
 118   1      }
 119          
 120          void LED_pro(void)
 121          {
 122   1        if (g_isS2Sleep == 0)
 123   1        {
 124   2          /* ¿ª»ú³£ÁÁÇÒ»¹Ã»½øÐÐÍ¨ÐÅ  */
 125   2          if (g_isCommErr == 1)
 126   2            g_bLedRun = 1;   
 127   2              // µ±Îª0Ê±½øÐÐÆµÉÁ
 128   2        }
 129   1        /* Ï¢ÆÁÊ±¹ØµÆ */
 130   1        else
 131   1        {
 132   2          g_bLedSOS = 0;
 133   2          g_bLedRun = 0;
 134   2        }
 135   1        pLedRun();
 136   1      }
 137          
 138          #if 0
              /* ÉèÖÃÖ¸Ê¾µÆµÄ²ÎÊýÁ¿ */
              void LED_pro(void)  
              {
                static u8 bLastTime;
                static bit isUpFlash;
              
              
                // Õâ¸öÊÇÔÝÊ±µÄ£¡£¡£¡£¡£¡
                u8 g_bPowerUpTimeOut1s, g_bPowerDownTimeOut1s;
                //¿ª»úÖ¸Ê¾µÆÉèÖÃ
                if (g_bPowerUpTimeOut1s > 0)
                {
                  if (bLastTime != g_bPowerUpTimeOut1s)
                  {
                    isUpFlash = !isUpFlash;
              
                    if (isUpFlash)
                    {
                      g_bLedRun = LED_ON;
                      g_bLedSOS = LED_OFF;
                      g_bLedLamp = LED_OFF;
                    }
                    else
                    {
                      g_bLedRun = LED_OFF;
                      g_bLedSOS = LED_ON;
                      g_bLedLamp = LED_OFF;
                    }
              
                    bLastTime = g_bPowerUpTimeOut1s;
                  }
                }
              
                //¹Ø»úÖ¸Ê¾µÆÉèÖÃ£¨×¼±¸¹Ø±Õ£©
                else if (g_bPowerDownTimeOut1s > 0)
                {
                  g_bLedRun = LED_ON;
                  g_bLedSOS = LED_ON;
                  g_bLedLamp = LED_OFF;
                }
C51 COMPILER V9.54   IO                                                                    04/22/2020 19:59:26 PAGE 4   

              
                //¹Ø»úÔòÈ«²¿Ö¸Ê¾µÆÃð£¨ÕæµÄ¹Ø±Õ£©
                else if (g_isS2Sleep)
                {
                  g_bLedRun = LED_OFF;
                  g_bLedSOS = LED_OFF;
                  g_bLedLamp = LED_OFF;
                }
                else       // Éè±¸ÔËÐÐÊ±µÄÌáÊ¾µÆ
                {
                  //Í¨Ñ¶¹ÊÕÏ£¨±£´æÊý¾Ý²¢È«µÆÃð£©
                  if (g_isCommErr)
                  {
                    //Í¨Ñ¶¹ÊÕÏÐèÒª±¸·ÝLED×´Ì¬
                    if (!g_isLedBak)
                    {
                      g_isLedBak = 1;
                      g_bLedRunBak = g_bLedRun;
                      g_bLedLampBak = g_bLedLamp;
                      g_bLedQjBak = g_bLedSOS;
                    }
                    g_bLedRun = LED_OFF;
                    g_bLedLamp = LED_OFF;
                    g_bLedSOS = LED_OFF;
                    //IO_PA_SHAN = 0;
                  }
                  // Õý³£Í¨Ñ¶£¨È«µÆÁÁ£©
                  else
                  {
                    if (g_isLedBak)
                    {
                      g_isLedBak = 0;
                      g_bLedRun = g_bLedRunBak;
                      g_bLedLamp = g_bLedLampBak;
                      g_bLedSOS = g_bLedQjBak;
                    }
                  }
                }
              
                pLedRun();
              
              }
              #endif
 222          /* IO¿Ú³õÊ¼»¯ */
 223          void IO_Init(void)  // Ò»°ãÄ¬ÈÏÊÇ×¼Ë«ÏòµÄ¹ÊÏÖÔÚ²»½øÐÐÐÞ¸Ä   ---- ¶øÇÒÌØ±ð×¢Òâusb_boot¹Ü½Å£¨Õâ¸öÊÇÒ»¶¨Îª¿ªÂ
             -©À­µÍ£¡£¡£¡£¡£¡£©
 224          {
 225   1        //Î´Ê¹ÓÃ¹Ü½Å£¬£­£­×¼Ë«Ïò£¬Ê¡µç
 226   1        P0M0 = P0M1 = 0;
 227   1        P1M0 = P1M1 = 0;
 228   1        P2M0 = P2M1 = 0;
 229   1        P3M0 = P3M1 = 0;
 230   1        P4M0 = P4M1 = 0;
 231   1      
 232   1        //LED¿ØÖÆ¹Ü½Å³õÊ¼»¯--×¼Ë«Ïò
 233   1        P3M1 &= ~(1 << 4);      // ÔËÐÐ
 234   1        P3M0 &= ~(1 << 4);
 235   1        P3M1 &= ~(1 << 5);      // Çó¾È
 236   1        P3M0 &= ~(1 << 5);
 237   1      
 238   1      //  P2M1 &= ~(1 << 1);      // ³äµç
 239   1      //  P2M0 &= ~(1 << 1);
C51 COMPILER V9.54   IO                                                                    04/22/2020 19:59:26 PAGE 5   

 240   1      
 241   1        // ÊÖµçÍ²£ºÍÆÍìºÍË«ÏòÎÞ²î±ð£»
 242   1      //  P2M1 &= ~((1 << 2) | (1 << 3));
 243   1      //  P2M0 &= ~((1 << 2) | (1 << 3));
 244   1      
 245   1        //KEY¹Ü½Å³õÊ¼»¯P3.2/3--×¼Ë«Ïò 
 246   1        P3M1 &= ~((1 << 2) | (1 << 3));
 247   1        P3M0 &= ~((1 << 2) | (1 << 3));
 248   1      //  P1M1 &= ~((1 << 2) | (1 << 3) | (1 << 4) | (1 << 5) | (1 << 6));
 249   1      //  P1M0 &= ~((1 << 2) | (1 << 3) | (1 << 4) | (1 << 5) | (1 << 6));
 250   1      
 251   1      #if 0
                // ³äµç¼ì²â--¸ß×è 
                P2M1 |= (1 << 4);
                P2M0 &= ~(1 << 4);
                IO_DECT_AC = 0;
                // ³äÂú¼ì²â--¸ß×è
                P3M1 |= (1 << 7);
                P3M0 &= ~(1 << 7);
                IO_DECT_CHG = 0;
                // ¹¦·ÅÊ¹ÄÜ--ÍÆÍì
                P0M1 &= ~(1 << 2);
                P0M0 |= (1 << 2);
                IO_PA_SHAN = 0;     // µÍ½ûÖ¹£¬Âö³åÊ¹ÄÜ
              #endif
 265   1      
 266   1      }
 267          
 268          
 269          /* IOÊ¡µç´¦Àí */
 270          void GPIO_SavePower(void)
 271          {
 272   1        //GSM_READY = 0;            // S2Êµ²âÎÞÐ§¹Ü½Å£¡£¡£¡´®½Óµç×è¶Ï¿ª£¡
 273   1        //GSM_PWRKEY = 1;           // À­µÍ¿ª»ú 
 274   1        //GSM_RESET = 1;            // µÍµçÆ½ > 31.25ms ¸´Î»
 275   1      
 276   1      
 277   1        // ³äµç¼ì²â--¸ß×è 
 278   1        //IO_DECT_AC = 0;
 279   1        // ³äÂú¼ì²â--¸ß×è
 280   1        //IO_DECT_CHG = 0;
 281   1        //IO_PA_SHAN = 0;     // µÍ½ûÖ¹£¬Âö³åÊ¹ÄÜ
 282   1      
 283   1        g_bLedRun = LED_OFF;
 284   1        g_bLedCd = LED_OFF;
 285   1        g_bLedLamp = LED_OFF;
 286   1        g_bLedSOS = LED_OFF;
 287   1        IO_LED_RUN = OFF_LED;   // ÔËÐÐÖ¸Ê¾
 288   1        IO_LED_SOS = OFF_LED;   // Çó¾ÈÖ¸Ê¾
 289   1      #if 0
                IO_LED_PWRIN = OFF_LED;   // ³äµçÖ¸Ê¾
                IO_LED_LAMP1 = OFF_LED;   // ÊÖµçÍ²
                IO_LED_LAMP2 = OFF_LED;
              #endif
 294   1      }
 295          
 296          #if 0
              /* ³äµç¼ì²â */
              void Check_AC_In(void)
              {
                // ³äµç¶Ï¿ª¼ì²â¡¢³äÂú¼ì²â
                if (bAC_In) {
C51 COMPILER V9.54   IO                                                                    04/22/2020 19:59:26 PAGE 6   

                  IO_DECT_AC = 1;
                  if (!IO_DECT_AC) {    // ¸ßµçÆ½³äµç
                    iDect_AC_Count++;
                    if (iDect_AC_Count >= 3) {
                      iDect_AC_Count = 0;
                      bAC_In = 0;
              
                      iPWR_In = 0;
                      PrintString1("CHG OUT");
                      g_bPower = '0';
                    }
                  }
              
                  // ³äÂú¼ì²â
                  if (bDect_Chg) {
                    IO_DECT_CHG = 0;
                    if (!IO_DECT_CHG) {
                      iDect_Bat_Count++;
                      if (iDect_Bat_Count >= 3)
                      {
                        iDect_Bat_Count = 0;
                        bDect_Chg = 0;
                        if (iPWR_In == 2)
                        {
                          iPWR_In = 1;    //×ªÎª¼ÌÐø³äµç×´Ì¬
                        }
              
                      }
              
                    }
              
                  }
                  else {
                    IO_DECT_CHG = 1;
                    if (IO_DECT_CHG) {
                      iDect_Bat_Count++;
                      if (iDect_Bat_Count >= 3)
                      {
                        iDect_Bat_Count = 0;
                        bDect_Chg = 1;
                        iPWR_In = 2;
                        PrintString1("BAT Full");
                        g_bPower = '2';
                      }
              
                    }
                  }
                  // ³äµç¼ì²â 
                }
                else {
                  IO_DECT_AC = 0;
                  if (IO_DECT_AC) {   // ¸ßµçÆ½³äµç
                    iDect_AC_Count++;
                    if (iDect_AC_Count >= 3) {
                      iDect_AC_Count = 0;
                      bAC_In = 1;
                      iPWR_In = 1;
                      PrintString1("CHG INSER");
                      g_bPower = '1';
                    }
                  }
                }
C51 COMPILER V9.54   IO                                                                    04/22/2020 19:59:26 PAGE 7   

              }
              #endif
 366          
 367          
 368          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    156    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      4    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
